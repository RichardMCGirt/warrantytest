<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warranty</title>
    <link rel="stylesheet" href="detail.css">
</head>
<body>

    <nav>
        <a href="index.html" class="back-button"> Back to Job List</a>
    </nav>
    <div class="scrollable-content">
    <div class="job-details-container">
        <form id="job-form">
            <label for="field-status">Status</label>
            <input type="text" id="field-status" name="field-status" readonly>

            <input type="text" id="job-name" readonly>
       
            <label>Field Technician:</label>
            <input type="text" id="field-tech" readonly>
            
            <label for="warranty-id">Warranty ID</label>
            <input type="text" id="warranty-id" readonly>
            <label for="StartDate">Start Date</label>
            <input type="datetime-local" id="StartDate" name="StartDate">
            
            <label for="EndDate">End Date</label>
            <input type="datetime-local" id="EndDate" name="EndDate">
            
            
            <label>Address:</label>
            <div style="display: flex; align-items: center; justify-content: left; gap: 10px;">
                <input type="text" id="address" readonly 
                    style="
                        cursor: pointer; 
                        background-color: #f8f9fa; 
                        border: 2px solid #007BFF; 
                        border-radius: 10px; 
                        font-size: 18px; 
                        text-align: center; 
                        padding: 14px; 
                        width: 100%; 
                        max-width: 600px; 
                        outline: none;
                        font-weight: bold;
                        color: #333;
                        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
                        transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, transform 0.1s ease-in-out;"
                    onclick="openMapApp()"
                    onmouseover="this.style.backgroundColor='#e0f2ff'; this.style.boxShadow='0px 4px 12px rgba(0, 123, 255, 0.3)'; this.style.transform='scale(1.02)';"
                    onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.boxShadow='0px 4px 8px rgba(0, 0, 0, 0.1)'; this.style.transform='scale(1)';"
                    placeholder="Click for Directions">
            </div>
            <br>
            <label>Homeowner Name:</label>
            <input type="text" id="homeowner-name" readonly>

            <label>Contact Email:</label>
<input type="email" id="contact-email" data-field="Contact Email" readonly>

<label>Description:</label>
<textarea id="description" data-field="Description of Issue" readonly ></textarea>

<label>DOW to be Completed:</label>
<textarea id="dow-completed" data-field="DOW to be Completed"
    style="width: 100%; font-size: 16px; padding: 10px;
           box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px;
           min-height: 80px; resize: vertical; display: block;"
    autocomplete="off" autocorrect="off" autocapitalize="sentences" spellcheck="false"></textarea>

<label id="subcontractor-dropdown1-label" for="subcontractor-dropdown1">Select a Subcontractor:</label>
<select id="subcontractor-dropdown" data-field="Subcontractor">
    <option value="">Select a Subcontractor...</option>
</select>

<div class="sub-completed-container">
    <label for="sub-not-needed">Sub not needed:</label>
    <input type="checkbox" id="sub-not-needed" data-field="Subcontractor Not Needed">
    
</div>
<br>

    <label for="subcontractor-payment">Subcontractor Payment</label>
    <input type="text" id="subcontractor-payment" name="subcontractor-payment" placeholder="$0.00" data-field="Subcontractor Payment" inputmode="decimal">

<div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background-color:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000;">
  <div id="previewContent" style="background:#fff; padding:20px; border-radius:10px; max-width:90%; max-height:90%; overflow:auto;">
    <span id="closePreview" style="position:absolute; top:20px; right:30px; font-size:30px; cursor:pointer; color:white;">&times;</span>
  </div>
</div>

<div id="additional-fields-container" style="padding: 16px;">
    <div class="form-group">
      <label for="billable-status" style="font-size: 18px; font-weight: 600; display: block; margin-bottom: 8px;">
        Billable Status
      </label>
      <div id="billable-status-container">
        <label class="billable-label">
          <input type="radio" name="billable-status" value="Billable" data-field="Billable/ Non Billable" />
          Billable
        </label>
        <label class="billable-label">
          <input type="radio" name="billable-status" value="Non Billable" data-field="Billable/ Non Billable" />
          Non-Billable
        </label>
      </div>
    </div>
 
        <div class="form-group" id="homeowner-builder-container" style="display: none;">
            <label for="homeowner-builder">Homeowner/Builder Pay</label>
            <select id="homeowner-builder" name="homeowner-builder" data-field="Homeowner Builder pay">
                <option value="Homeowner">Homeowner</option>
                <option value="Builder">Builder</option>
                <option value=""></option>

            </select>
        </div>
        
</div>


<div class="form-group" id="billable-reason-container" style="display: none;">
    <label for="billable-reason">Billable Reason</label>
    <select id="billable-reason" name="billable-reason" data-field="Billable Reason (If Billable)">
        <option value="Another Trade Damaged Work">Another Trade Damaged Work</option>
        <option value="Homeowner Damage">Homeowner Damage</option>
        <option value="Framing Issue">Framing Issue</option>
        <option value="Weather">Weather</option>
        <option value=""></option>

    </select>
</div>

    <div id="message-container"></div>
    <div class="form-group" style="display: none;">
        <label>Field Review Not Needed:</label>
        <input type="checkbox" id="field-review-needed" data-field="Field Review Not Needed">
    </div>
    
    <div class="form-group" style="display: none;">
        <label>Field Review Needed:</label>
        <input type="checkbox" id="field-review-not-needed" data-field="Field Review Needed">
    </div>

    <div id="material-needed-container" class="material-needed-container"
    style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 10px 0;">


    <select id="material-needed-select" 
        style="width: fit-content; font-size: 20px; padding: 5px 10px; border-radius: 5px; box-sizing: border-box;">
        <option value="" disabled selected>Select if materials are needed</option>
        <option value="Do Not Need Materials">Do Not Need Materials</option>
        <option value="Needs Materials">Needs Materials</option>
    </select>

    <div class="form-group" id="materials-needed-container">
        <label for="materials-needed" id="materials-needed-label">Materials Needed</label>
        <textarea id="materials-needed" name="materials-needed" data-field="Materials Needed"
        style="width: 100%; font-size: 20px; padding: 10px;
               box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px;
               min-height: 80px; resize: vertical; display: block;"
        autocomplete="off" autocorrect="on" autocapitalize="sentences" spellcheck="true"></textarea>
    
    </div>
</div>

        <div class="file-input-container">
         <!--   <label id="upload-issue-picture-label" class="custom-file-label" for="upload-issue-picture">
                Upload Issue Pictures
              </label> -->
              <input
              type="file"
              id="upload-issue-picture"
              multiple
              accept="image/*"
              style="display: none;"
            >
            <button id="trigger-issue-upload" type="button" style="margin: 10px; padding: 10px 15px; font-size: 16px;">
               Upload Issue Image
            </button>       
                 <div id="issue-file-list"></div>
        </div>

        <div id="issue-pictures" style="display: none;"></div>
<br>

<div class="form-group centered-checkbox">
    <label id="field-tech-reviewed-label" for="field-tech-reviewed">Field Tech Reviewed:</label>
    <input type="checkbox" id="field-tech-reviewed" data-field="Field Tech Reviewed">
</div>

    <!-- Preview area for uploaded images -->
    <div id="file-preview" class="file-preview"></div>


    <div id="file-input-container">
      <!--  <label class="custom-file-label" for="upload-completed-picture">Upload Completed Pictures</label> -->
        <input
        type="file"
        id="upload-completed-picture"
        multiple
        accept="image/*"
        style="display: none;"
      >
      <button id="trigger-completed-upload" type="button" style="margin: 10px; padding: 10px 15px; font-size: 16px;">
        upload Completed Image
      </button>        
      <div id="file-list"></div>
    </div>
    

<!-- Preview area for uploaded images -->
<div id="completed-pictures" class="file-preview" style="display: none;"></div>

<button id="delete-images-btn" 
    style="background:red; color:white; padding:10px; border:none; cursor:pointer; display: none;">
    Delete Selected Images
</button>

<div class="job-completed-container">
    <label id="job-completed" for="job-completed">Job Completed:</label>
    <input type="checkbox" id="job-completed-check" data-field="Job Completed">
</div>
<div id="file-preview" class="file-preview"></div>

</div>

<button type="button" id="save-job">Save Changes</button>

        </form>
    </div>

    <script>
        window.env = {
           AIRTABLE_API_KEY: 'patM49mmBDFbP6y2n.545e1307aae93d7bd5fd579bc395039d43fece72fa6df5085bae343817d614ff',
           AIRTABLE_BASE_ID: 'appO21PVRA4Qa087I',
           AIRTABLE_TABLE_NAME: 'tbl6EeKPsNuEvt5yJ',
           AIRTABLE_TABLE_NAME2: 'tbl9SgC5wUi2TQuF7',

           AIRTABLE_SUBCONTRACTOR_TABLE_NAME: 'tbl9SgC5wUi2TQuF7' 
        };
    </script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const materialSelect = document.getElementById("material-needed-select");
  const materialsTextarea = document.getElementById("materials-needed");
  const textareaContainer = document.getElementById("materials-needed-container");

  const placeholderOption = materialSelect.querySelector('option[value=""]');

    // Show/hide textarea when user changes selection with confirmation
    materialSelect.addEventListener("change", function () {
    console.log("ðŸ”„ Dropdown changed to:", this.value);

    if (this.value === "Needs Materials") {
      console.log("ðŸ“‚ Showing materials-needed textarea");
      textareaContainer.style.display = "block";
    } else if (this.value === "Do Not Need Materials") {
      if (materialsTextarea.value.trim() !== "") {
        const confirmed = confirm("âš ï¸ You have entered materials. Do you want to clear them?");
        if (confirmed) {
          console.log("ðŸ§¹ User confirmed clearing materials textarea.");
          materialsTextarea.value = "";
          textareaContainer.style.display = "none";
        } else {
          console.log("âŒ User canceled. Reverting dropdown to 'Needs Materials'");
          this.value = "Needs Materials";
          textareaContainer.style.display = "block"; // show again in case it was hidden
        }
      } else {
        console.log("ðŸ“ Hiding textarea (no content to clear)");
        textareaContainer.style.display = "none";
      }
    }
  });

});

    document.getElementById("trigger-issue-upload").addEventListener("click", () => {
      document.getElementById("upload-issue-picture").click();
    });
  
    document.getElementById("trigger-completed-upload").addEventListener("click", () => {
      document.getElementById("upload-completed-picture").click();
    });

    document.addEventListener("DOMContentLoaded", function () {
    const subcontractorPaymentInput = document.getElementById("subcontractor-payment");

    if (subcontractorPaymentInput) {
        subcontractorPaymentInput.addEventListener("input", function (e) {
            let value = e.target.value;

            // ðŸ§¹ Allow user to type $ but clean extra $ if multiple
            value = value.replace(/[^\d.]/g, ""); // remove everything except digits and decimal

            // ðŸ›¡ Prevent multiple decimals
            const parts = value.split(".");
            if (parts.length > 2) {
                value = parts[0] + "." + parts[1];
            }

            // ðŸŒŸ Always format with a single $
            e.target.value = value ? `$${value}` : "";
        });

        subcontractorPaymentInput.addEventListener("blur", function (e) {
            let value = e.target.value.replace(/[^\d.]/g, ""); // Remove $ and commas

            if (value) {
                value = parseFloat(value).toFixed(2);
                e.target.value = `$${Number(value).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            } else {
                e.target.value = "";
            }
        });

        subcontractorPaymentInput.addEventListener("focus", function (e) {
            let value = e.target.value.replace(/[^\d.]/g, ""); // Remove $ when focusing
            e.target.value = value;
        });
    }
});

  </script>
      
    <script src="job-details.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>

</body>
</html>